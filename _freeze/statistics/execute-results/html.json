{
  "hash": "c2ea58b6c828554fddf440fac43d05ab",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Statistics\"\neditor: visual\noutput:\n  html_document:\n    toc: true\n    toc_float: true\n    number_sections: false\n---\n\n\n\n## 6. Population Genetic Statistics\n\n::: callout-note\n### Exercises for Section 6. Population Genetic Statistics\n\n-   What information do we have?\n-   Generate statistics for both datasets - SEA and AFR\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ensure order of metadata matches gl_SEA\nmeta_ord_SEA <- meta[match(indNames(gl_SEA), meta$sample), ]\nstopifnot(all(meta_ord_SEA$sample == indNames(gl_SEA)))\n\n# Convert to genind then extract allele matrix\ngi_SEA <- gl2gi(gl_SEA)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStarting gl2gi \n  Processing genlight object with SNP data\nMatrix converted.. Prepare genind object...\nCompleted: gl2gi \n```\n\n\n:::\n\n```{.r .cell-code}\ntab_SEA <- gi_SEA@tab   # individuals × SNPs\n\n# optional save\nsaveRDS(gi_SEA, file = \"derived/gi_SEA.rds\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Basic diversity stats per population\npop_stats <- poppr(gi_SEA)\npop_stats\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       Pop  N MLG eMLG       SE   H  G lambda E.5  Hexp    Ia    rbarD   File\n1 Cambodia 30  30   30 0.00e+00 3.4 30  0.967   1 0.383 0.566 0.003011 gi_SEA\n2     Laos 30  30   30 0.00e+00 3.4 30  0.967   1 0.348 0.105 0.000593 gi_SEA\n3 Thailand 30  30   30 0.00e+00 3.4 30  0.967   1 0.356 0.109 0.000613 gi_SEA\n4    Total 90  90   30 1.64e-06 4.5 90  0.989   1 0.369 0.433 0.002285 gi_SEA\n```\n\n\n:::\n\n```{.r .cell-code}\n# Pairwise Fst (Nei) between populations\nfst_sea <- pairwise.neifst(gi_SEA)\n```\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n## Click to see output\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n         Cambodia   Laos Thailand\nCambodia       NA 0.0087   0.0111\nLaos       0.0087     NA   0.0039\nThailand   0.0111 0.0039       NA\n```\n\n\n:::\n:::\n\n:::\n\n### **Why compute FST?**\n\n-   Measures genetic differentiation between populations.\n\n-   Higher FST = populations are more genetically distinct.\n\n-   Helps identify imported clusters vs. local diversity.\n\n### **Strengths**\n\n-   Standard metric used in population genetics.\n\n-   Easy to compare across studies.\n\n### **Weaknesses**\n\n-   Influenced by sample size.\n\n-   Can’t distinguish drift from selection.\n\n-   Doesn’t account for gene flow direction.\n\n## 7. Nucleotide Diversity\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalc_pi <- function(mat) {\n  # mat = matrix of alleles coded 0/1 (ref/alt), rows = samples, cols = SNPs\n  \n  if (!is.matrix(mat)) mat <- as.matrix(mat)\n  \n  # Proportion of pairwise differences for each SNP\n  # π_snp = (2 * p * q)\n  p <- colMeans(mat, na.rm = TRUE)       # freq of ALT allele\n  q <- 1 - p                             # freq of REF allele\n  pi_per_snp <- 2 * p * q                # expected heterozygosity\n  \n  # Mean nucleotide diversity across all SNPs\n  mean(pi_per_snp, na.rm = TRUE)\n}\n\n# Calculate π per site\npi_per_site <- meta_ord_SEA %>%\n  group_split(site) %>%         # split metadata into list by site\n  map_df(function(df_site) {    # loop over each site\n    samples <- df_site$sample   # sample IDs in this site\n\n    # Select corresponding rows of allele matrix\n    mat <- tab_SEA[rownames(tab_SEA) %in% samples, , drop = FALSE]\n\n    tibble(\n      site = unique(df_site$site),\n      pi = calc_pi(mat)\n    )\n  })\n\npi_per_site\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 2\n  site             pi\n  <chr>         <dbl>\n1 Battambang   -0.642\n2 Champasak    -0.680\n3 Kanchanaburi -0.652\n4 Pailin       -0.563\n5 Pursat       -0.609\n6 Savannakhet  -0.692\n7 Sisaket      -0.658\n```\n\n\n:::\n\n```{.r .cell-code}\nnuc_sea <- ggplot(pi_per_site, aes(x = reorder(site, pi), y = pi, fill = site)) +\n  geom_col() +\n  theme_minimal() +\n  scale_fill_viridis_d() +\n  labs(\n    title = \"Nucleotide Diversity (π) per Site\",\n    x = \"Site\",\n    y = \"Nucleotide Diversity (π)\"\n  )\n```\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n## Click to see plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](statistics_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n:::\n\n### **Why calculate nucleotide diversity?**\n\n-   Measures genetic variation within a population.\n\n-   π reflects the average number of nucleotide differences per site between two genomes.\n\n-   In outbreak genomics:\n\n    -   Low π → **clonal**, single-source introduction\n\n    -   High π → **diverse**, long-standing transmission\n\n### **Strengths**\n\n-   Very intuitive measure of diversity\n\n-   Useful for comparing sites, years, countries.\n\n### **Weaknesses**\n\n-   Requires high-quality SNP data.\n\n-   Sensitive to missingness and uneven sample sizes.\n",
    "supporting": [
      "statistics_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}